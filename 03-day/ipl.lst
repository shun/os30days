     1                                  ;;  -*- tab-width : 4 -*-
     2                                  ;; myos
     3                                  
     4                                  		ORG		0x7c00
     5                                  		
     6                                  ;; basic parameters for FAT12 format
     7                                  
     8 00000000 EB4A                    		JMP SHORT		entry
     9 00000002 90                      		DB		0x90
    10 00000003 4D594F53                		DB		"MYOS"			; boot sector name
    11 00000007 0002                    		DW		512				; size of 1 sector				(should be 512)
    12 00000009 01                      		DB		1				; size of claster				(should be 1 sector)
    13 0000000A 0100                    		DW		1				; location of the sector		(should be 1st sector)
    14 0000000C 02                      		DB		2				; nomber of FAT					(should be 2)
    15 0000000D E000                    		DW		224				; size of root directory		(224 entry basically)
    16 0000000F 400B                    		DW		2880			; size of this drive			(should be 2880 sectors)
    17 00000011 F0                      		DB		0xf0			; media type					(should be 0xf0)
    18 00000012 0900                    		DW		9				; length of FAT area			(should be 9 sectors)
    19 00000014 1200                    		DW		18				; nomber of sectors per 1 track (should be 18 sectors)
    20 00000016 0200                    		DW		2				; nomber of head				(should be 2)
    21 00000018 00000000                		DD		0				; should be 0 because no pertition this time
    22 0000001C 400B0000                		DD		2880			; set the size for this drive again
    23 00000020 000029                  		DB		0,0,0x29		; magic number
    24 00000023 FFFFFFFF                		DD		0xffffffff		; volume serial number (maybe)
    25 00000027 4D594F532020202020-     		DB		"MYOS       "	; disk name						(fixed 11 bytes)
    26 00000030 2020               
    27 00000032 4641543132202020        		DB		"FAT12   "		; format name					(fixed 8 bytes)
    28 0000003A <res 00000012>          		RESB	18				; reserve 18 bytes
    29          ******************       warning: uninitialized space declared in .text section: zeroing
    30                                  
    31                                  ;; program body
    32                                  
    33                                  entry:
    34 0000004C B80000                  		MOV		AX,0			; initialize AX register (= 0)
    35 0000004F 8ED0                    		MOV		SS,AX			
    36 00000051 BC007C                  		MOV		SP,0x7c00
    37 00000054 8ED8                    		MOV		DS,AX			; initialize DS register as AX
    38                                  		
    39                                  ;; read the disk
    40                                  		
    41 00000056 B82008                  		MOV		AX, 0x0820
    42 00000059 8EC0                    		MOV		ES, AX
    43 0000005B B500                    		MOV		CH, 0			; sylinder 0
    44 0000005D B600                    		MOV		DH, 0			; head 0
    45 0000005F B102                    		MOV		CL, 2			; sector 2
    46                                  
    47 00000061 B402                    		MOV		AH, 0x02		; read disk
    48 00000063 B001                    		MOV		AL, 1			; 1 sector
    49 00000065 BB0000                  		MOV		BX, 0
    50 00000068 B200                    		MOV		DL, 0x00
    51 0000006A CD13                    		INT		0x13
    52 0000006C 7203                    		JC SHORT	error
    53                                  
    54                                  fin:
    55 0000006E F4                      		HLT						; suspend CPU untile something happen
    56 0000006F EBFD                    		JMP SHORT		fin				; infinity loop
    57                                  
    58                                  error:
    59 00000071 BE[8600]                		MOV		SI, msg
    60                                  		
    61                                  putloop:
    62 00000074 8A04                    		MOV		AL,[SI]
    63 00000076 83C601                  		ADD		SI,1			; increment SI
    64 00000079 3C00                    		CMP		AL,0
    65 0000007B 74F1                    		JE SHORT		fin
    66 0000007D B40E                    		MOV		AH,0x0e			; display 1 charactor function
    67 0000007F BB0F00                  		MOV		BX,15			; color code
    68 00000082 CD10                    		INT		0x10			; call video BIOS
    69 00000084 EBEE                    		JMP SHORT		putloop
    70                                  
    71                                  
    72                                  msg:
    73 00000086 0A0A                    		DB		0x0a,0x0a		; CR x 2
    74 00000088 232323204552524F52-     		DB		"### ERROR ### load error"	; message data
    75 00000091 20232323206C6F6164-
    76 0000009A 206572726F72       
    77 000000A0 0A                      		DB		0x0a			; CR
    78 000000A1 00                      		DB		0
    79                                  
    80 000000A2 <res 0000015C>          		RESB	0x01fe-($-$$)	; reserve by 0x1fe
    81          ******************       warning: uninitialized space declared in .text section: zeroing
    82                                  
    83 000001FE 55AA                    		DB		0x55,0xaa
    84                                  
